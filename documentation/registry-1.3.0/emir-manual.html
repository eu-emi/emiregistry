<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.8" />
<title>EMI Registry Manual</title>
<style type="text/css">
/* Debug borders */
p, li, dt, dd, div, pre, h1, h2, h3, h4, h5, h6 {
/*
  border: 1px solid red;
*/
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

tt {
  color: navy;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  font-family: sans-serif;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}

div.sectionbody {
  font-family: serif;
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}

pre {
  padding: 0;
  margin: 0;
}

span#author {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  font-size: 1.1em;
}
span#email {
}
span#revnumber, span#revdate, span#revremark {
  font-family: sans-serif;
}

div#footer {
  font-family: sans-serif;
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
div#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
div#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

div#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.tableblock, div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid silver;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid silver;
  background: #f4f4f4;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #dddddd;
  color: #777777;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > div.content {
  white-space: pre;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-family: sans-serif;
  font-weight: bold;
}
tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}


@media print {
  div#footer-badges { display: none; }
}

div#toc {
  margin-bottom: 2.5em;
}

div#toctitle {
  color: #527bbd;
  font-family: sans-serif;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}
/* Workarounds for IE6's broken and incomplete CSS2. */

div.sidebar-content {
  background: #ffffee;
  border: 1px solid silver;
  padding: 0.5em;
}
div.sidebar-title, div.image-title {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  margin-top: 0.0em;
  margin-bottom: 0.5em;
}

div.listingblock div.content {
  border: 1px solid silver;
  background: #f4f4f4;
  padding: 0.5em;
}

div.quoteblock-attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock-content {
  white-space: pre;
}
div.verseblock-attribution {
  padding-top: 0.75em;
  text-align: left;
}

div.exampleblock-content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

/* IE6 sets dynamically generated links as visited. */
div#toc a:visited { color: blue; }
</style>
<script type="text/javascript">
/*<![CDATA[*/
window.onload = function(){asciidoc.fixReferences();asciidoc.footnotes(); asciidoc.toc(2);}
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([2-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},

fixReferences: function () {

  // own implementation of this since it is not supported by all browsers (IE - as usual :)
  function getElementsByClassName(element, class_name)
  {
    var all_obj,ret_obj=new Array(),k=0,teststr;

    if(element.all)all_obj=element.all;
    else if(element.getElementsByTagName && !element.all)
      all_obj=element.getElementsByTagName("*");
    for(var j=0;j<all_obj.length;j++)
    {
      if(all_obj[j].className.indexOf(class_name)!=-1)
      {
        teststr=","+all_obj[j].className.split(" ").join(",")+",";
        if(teststr.indexOf(","+class_name+",")!=-1)
        {
          ret_obj[k]=all_obj[j];
          k++;
        }
      }
    }
    return ret_obj;
  }


  function storeSectionNum(refNames,element) {
    if(element != null)
    {
        var id = element.getAttribute("id");
        if(element.innerHTML.match("^[0-9.]+ .*"))
        {
           var parts = element.innerHTML.split(" ");
           var refName = parts[0];
           if(refName.match("\\.$")==".")
           {
             refName = refName.substr(0,refName.length-1);
           }
           refNames[id] = "Section "+refName;
        }
    }
  }

  function storeImageNum(refNames,imageblock) {
    var id = imageblock.getAttribute("id");
    var element = getElementsByClassName(imageblock,"image-title")[0];
    var match;
    if(element != null)
    {
        if(match = element.innerHTML.match("^\\w+\\s+([0-9.]+).*"))
        {
           var refName = match[1];
           refNames[id] = "Figure "+refName;
        }
    }
  }

  var refNames = new Array();
  var elements = document.getElementsByTagName("h2");
  for (var i = 0; i < elements.length; ++i) {
    storeSectionNum(refNames,elements[i]);
  }

  elements = document.getElementsByTagName("h3");
  for (var i = 0; i < elements.length; ++i) {
    storeSectionNum(refNames,elements[i]);
  }

  elements = document.getElementsByTagName("h4");
  for (var i = 0; i < elements.length; ++i) {
    storeSectionNum(refNames,elements[i]);
  }

  elements = getElementsByClassName(document,"imageblock");
  for (var i = 0; i < elements.length; ++i) {
    storeImageNum(refNames,elements[i]);
  }

  for (var i = 0; i < document.links.length; ++i)
  {
    var link = document.links[i];
    var refName = refNames[link.href.split("#")[1]];
    if(refName != null)
    {
      link.innerHTML=refName;
    }
  }
},

/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  var cont = document.getElementById("content");
  var noteholder = document.getElementById("footnotes");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      // Use [\s\S] in place of . so multi-line matches work.
      // Because JavaScript has no s (dotall) regex flag.
      note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      spans[i].innerHTML =
        "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
        "' title='View footnote' class='footnote'>" + n + "</a>]";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
}

}
/*]]>*/
</script>
</head>
<body>
<div id="header">
<h1>EMI Registry Manual</h1>
<span id="author">EMIR Product Team</span><br />
<span id="revnumber">version 1.3.0,</span>
<span id="revdate">24 06 2013</span>
<br /><span id="revremark">component version: 1.3.0</span>
<div id="toc">
  <div id="toctitle">Table of Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<div id="content">
<h2 id="_overview">1. Overview</h2>
<div class="sectionbody">
<h3 id="_emir_server_dsr_or_gsr">1.1. EMIR Server (DSR or GSR)</h3><div style="clear:left"></div>
<div class="paragraph"><p>EMI Service Registry is a Service Endpoint Registry designed and implemented during the EMI project. Its main goal is to discover all the Service Endpoints that exist.
It consists of a collection of services that enables storing service records in a federated manner. Each of the record is a Service Endpoint Record (SER)
complying with the OGF&#8217;s GLUE 2.0 standard. The deployment of EMIR (which implies building an EMIR network over WAN) is bipartite: 1) Building a rooted
hierarchy with a single EMIR server aggregating all the information within a federation 2) Sharing the information at the root level among peered
EMIR servers (using P2P), thus enabling intra-federation discovery.</p></div>
<div class="paragraph"><p>Feature Highlights:</p></div>
<div class="ulist"><ul>
<li>
<p>
the service endpoint record registration includes the management of the services' endpoint information.
</p>
</li>
<li>
<p>
Powerful data back-end based on MongoDB
</p>
</li>
<li>
<p>
Schema-free information model based on JSON (using GLUE2 entity names for specific attributes)
</p>
</li>
<li>
<p>
REST-ful API to browse the service registrations
</p>
</li>
<li>
<p>
Security
</p>
<div class="ulist"><ul>
<li>
<p>
PKI governed authentication
</p>
</li>
<li>
<p>
Policy based authorisation
</p>
</li>
</ul></div>
</li>
</ul></div>
<div class="paragraph"><p>For more information about EMIR, visit EMI&#8217;s <a href="https://twiki.cern.ch/twiki/bin/view/EMI/EMIRegistry">TWiki</a>.</p></div>
<h3 id="_emir_8217_s_service_endpoint_record_publisher_emir_serp">1.2. EMIR&#8217;s Service Endpoint Record Publisher (EMIR-SERP)</h3><div style="clear:left"></div>
<div class="paragraph"><p>The UMD services need to be registered into the EMI Registry service
infrastructure to be discoverable for the clients. Most of the services
or even the containers executing them provide a way to do this but not
all of them. For those that are unable to register themselves
automatically and periodically the EMIR-SERP is available.</p></div>
<div class="paragraph"><p>The EMIR-SERP is a daemon like (background) service that can be executed next to these
services (preferably on the same machine) and able to perform the
automatic and periodical registration and update against the
configured EMI Registry service on behalf of the service itself. This
client uses exactly the same, standard RESTful API as the other clients
do.</p></div>
<div class="paragraph"><p>Most of the parameters of these registrations and updates can be
configured. For the details see the <a href="#anchor-emir-serp-config">Configuration section</a>!</p></div>
<div class="paragraph"><p>After the successful registration until the termination of the daemon,
the EMIR-SERP client do the periodical updates then finally, when the execution of
the daemon is over, it attempts to delete the service entries from the
remote database.</p></div>
<div class="paragraph"><p>The service entries can be defined in single files, in multiple files in
a watchdir (that is periodically scanned for new files) or in resource
BDIIs.</p></div>
<div class="paragraph"><p>The entries can contain any kind of information allowed and accepted by the EMI Regisrty
services and can be configured in the form of whole, formatted <strong>json</strong>
documents or LDAP in case of BDII usage. The LDIF &#8594; JSON converson is
also performed by EMIR-SERP.</p></div>
</div>
<h2 id="_getting_started_in_5_minutes">2. Getting Started in 5 Minutes</h2>
<div class="sectionbody">
<h3 id="_domain_service_registry_dsr">2.1. Domain Service Registry (DSR)</h3><div style="clear:left"></div>
<div class="paragraph"><p>This sections explains how to setup a Domain Service Registry (DSR) for a site. As a prerequisite, any SL6 host, either real of virtual is required.</p></div>
<h4 id="_installing_the_dsr">2.1.1. Installing the DSR</h4>
<div class="paragraph"><p><a id="anchor-quick-dsr-installation"></a></p></div>
<div class="paragraph"><p>Install the EMI release package</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>rpm -Uvh http://emisoft.web.cern.ch/emisoft/dist/EMI/2/sl6/x86_64/base/emi-release-2.0.0-1.sl6.noarch.rpm</tt></pre>
</div></div>
<div class="paragraph"><p>Install the EMI Registry package.</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>yum install -y emi-emir</tt></pre>
</div></div>
<h4 id="_configure_the_dsr">2.1.2. Configure the DSR</h4>
<div class="paragraph"><p>Edit the file</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>/etc/emi/emir/emir.config</tt></pre>
</div></div>
<div class="paragraph"><p>and set the hostname and port.</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>emir.address=http://example.com:9126</tt></pre>
</div></div>
<div class="paragraph"><p>Set the DSR parent attribute.</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>emir.parentAddress=http://parent.example.com:9126</tt></pre>
</div></div>
<div class="paragraph"><p>Start the services</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>service mongod start
services emi-emir start</tt></pre>
</div></div>
<h4 id="_test_the_dsr">2.1.3. Test the DSR</h4>
<div class="paragraph"><p>Check that the DSR is running</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>http://example.com:9126/ping</tt></pre>
</div></div>
<h3 id="_global_service_registry_gsr">2.2. Global Service Registry (GSR)</h3><div style="clear:left"></div>
<h4 id="_installing_the_dsr_2">2.2.1. Installing the DSR</h4>
<div class="paragraph"><p>Same as <a href="#anchor-quick-dsr-installation">DSR</a></p></div>
<h4 id="_configuration">2.2.2. Configuration</h4>
<div class="paragraph"><p>Edit the file</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>/etc/emi/emir/emir.config</tt></pre>
</div></div>
<div class="paragraph"><p>and set the hostname and port.</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>emir.address=http://example.com:9126</tt></pre>
</div></div>
<div class="paragraph"><p>set the global GSR flag</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>emir.global.enable=true</tt></pre>
</div></div>
<div class="paragraph"><p>Start the services</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>service mongod start
services emi-emir start</tt></pre>
</div></div>
<h4 id="_test_the_gsr">2.2.3. Test the GSR</h4>
<div class="paragraph"><p>Check that the GSR is running</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>http://example.com:9126/ping</tt></pre>
</div></div>
<h3 id="_service_endpoint_record_publisher_emir_serp_with_site_bdii_information_source">2.3. Service Endpoint Record Publisher (EMIR-SERP) with site BDII information source</h3><div style="clear:left"></div>
<h4 id="_installing_the_emir_serp">2.3.1. Installing the EMIR-SERP</h4>
<div class="paragraph"><p>Install the emir-serp.</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>yum install emir-serp</tt></pre>
</div></div>
<div class="paragraph"><p>Install the service translator</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>rpm -Uvh http://cern.ch/lfield/ginfo-0.1.5-1.noarch.rpm</tt></pre>
</div></div>
<h4 id="_configure_the_emir_serp_publisher">2.3.2. Configure the EMIR-SERP (publisher)</h4>
<div class="paragraph"><p>Edit the file /etc/emi/emir-serp/emir-serp.ini and set the url for yor DSR.</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>url = http://example.com:9126</tt></pre>
</div></div>
<div class="paragraph"><p>Set the json_dir_location</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>json_dir_location = /var/cache/emir-serp/services</tt></pre>
</div></div>
<div class="paragraph"><p>Create the json directory.</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>mkdir -p /var/cache/emir-serp/services</tt></pre>
</div></div>
<div class="paragraph"><p>Create a hourly cron job to run the following command, where <em>bdii.example.com</em> is the host name of a site BDII.</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>ginfo --host bdii.example.com --emi &gt; /var/cache/emir-serp/services/example</tt></pre>
</div></div>
<div class="paragraph"><p>Start the service</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>service emir-serp start</tt></pre>
</div></div>
<h4 id="_test_the_emir_serp">2.3.3. Test the EMIR-SERP</h4>
<div class="paragraph"><p>Check the expected services are published</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>http://example.com:9126/services</tt></pre>
</div></div>
<h3 id="_service_endpoint_record_publisher_emir_serp_with_resource_bdii_information_source">2.4. Service Endpoint Record Publisher (EMIR-SERP) with resource BDII information source</h3><div style="clear:left"></div>
<h4 id="_installing_the_emir_serp_2">2.4.1. Installing the EMIR-SERP</h4>
<div class="paragraph"><p>Install the emir-serp.</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>yum install emir-serp</tt></pre>
</div></div>
<h4 id="_configure_the_emir_serp_publisher_2">2.4.2. Configure the EMIR-SERP (publisher)</h4>
<div class="paragraph"><p>Edit the file /etc/emi/emir-serp/emir-serp.ini and set the url for yor
DSR and setup your credentials if needed.</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>url = http://example.com:9126</tt></pre>
</div></div>
<div class="paragraph"><p>Set the resource_bdii_url variable.</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>resource_bdii_url = ldap://your.resource.bdii:2135/o=glue</tt></pre>
</div></div>
<div class="paragraph"><p>Start the service</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>service emir-serp start</tt></pre>
</div></div>
<h4 id="_test_the_emir_serp_2">2.4.3. Test the EMIR-SERP</h4>
<div class="paragraph"><p>Check the expected services are published</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>http://example.com:9126/services</tt></pre>
</div></div>
</div>
<h2 id="_installation">3. Installation</h2>
<div class="sectionbody">
<h3 id="_emir_server_dsr_or_gsr_2">3.1. EMIR Server (DSR or GSR)</h3><div style="clear:left"></div>
<div class="paragraph"><p>In order to install EMIR Server, it is a pre-requisite to install
SUN or OpenJDK Java 6 (JRE or SDK). If not installed
on the target system, it can be downloaded from <a href="http://java.oracle.com">http://java.oracle.com</a></p></div>
<div class="ulist"><ul>
<li>
<p>
Linux based operating system
</p>
</li>
<li>
<p>
<a href="http://www.mongodb.org">MongoDB</a>
</p>
</li>
</ul></div>
<div class="paragraph"><p>EMIR is distributed in the following formats:</p></div>
<div class="ulist"><ul>
<li>
<p>
Platform independent format, provided in "tar.gz" format
</p>
</li>
<li>
<p>
RPM package, suitable SL5/SL6 and other Fedora based Linux derivatives (RedHat, CentOS etc&#8230;)
</p>
</li>
<li>
<p>
Debian package
</p>
</li>
</ul></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">IMPORTANT NOTE ON PATHS</div>
<div class="paragraph"><p>The location of the installation and configuration files differ
depending on the type of bundle (see the above section).</p></div>
<div class="paragraph"><p>If RPM bundle is being installed, the following paths will be used:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>CONF=/etc/emi/emir
BIN=/usr/sbin
LOG=/var/log/emi/emir
LIB=/usr/share/emi/emir/lib</tt></pre>
</div></div>
<div class="paragraph"><p>The platform independent binary places all the files under
single directory. The contents will be:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>CONF=INST/conf/
BIN=INST/bin/
LOG=INST/logs/
LIB=INST/lib/</tt></pre>
</div></div>
<div class="paragraph"><p>The above variables (CONF, BIN, LOG, and LIB) will be used throughout the rest of this manual.</p></div>
</td>
</tr></table>
</div>
<h4 id="_installation_using_the_rpm_bundle_redhat_distributions">3.1.1. Installation using the RPM bundle (RedHat Distributions)</h4>
<div class="paragraph"><p>Download EMIR Server&#8217;s RPM distribution from the EMI&#8217;s <a href="http://emisoft.web.cern.ch/emisoft/">emisoft</a> and install it
using the rpm or yum command.</p></div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre><tt>yum install -y emi-emir</tt></pre>
</div></div>
<h4 id="_installation_on_debian_centos_debian_distributions">3.1.2. Installation on Debian (Centos/Debian Distributions)</h4>
<div class="paragraph"><p>Download EMIR DEB distribution from the EMI&#8217;s <a href="http://emisoft.web.cern.ch/emisoft/">emisoft</a> and install it
using the apt-get command.</p></div>
<h4 id="_database_installation">3.1.3. Database Installation</h4>
<div class="paragraph"><p>EMIR server uses MongoDB database as a backbone to store and indexe SER collections. The database dependency
will automatically be fetched from the <strong>emisoft</strong> repository, while installing the EMIR Server. Otherwise it
should be installed and configured before installing the EMIR. The installation and configuration
instructions to setup the MongoDB database can be found on MongoDB&#8217;s <a href="http://www.mongodb.org/display/DOCS/Quickstart">Web site</a>.</p></div>
<h4 id="_installation_from_the_self_contained_archive_tar_gz">3.1.4. Installation from the self-contained archive (tar.gz)</h4>
<div class="paragraph"><p>In order to generate, build and install the self contained binary it is required to follow the
steps written below:</p></div>
<div class="olist arabic"><div class="title">Creating the Bundle</div><ol class="arabic">
<li>
<p>
check out the source code from <strong>git://github.com/eu-emi/emiregistry.git</strong>
</p>
</li>
<li>
<p>
go to <strong>SOURCE_ROOT/emir-dist</strong> directory
</p>
</li>
<li>
<p>
run <strong>mvn assembly:assembly -DskipTests</strong>
</p>
</li>
</ol></div>
<div class="paragraph"><p>The archive can be found inside the <strong>SOURCE_ROOT/target/emir-distribution-x.y.z-a-all.(tar.gz/zip)</strong>,
that contains all the necessary files for installation thus no special actions will be required except
extraction to the target folder.</p></div>
<h3 id="_installing_the_publisher_client_emir_serp">3.2. Installing the Publisher Client: EMIR-SERP</h3><div style="clear:left"></div>
<div class="paragraph"><p><a id="anchor-emir-serp-installation"></a></p></div>
<div class="paragraph"><p>The installation of the EMIR-SERP client is trivial. The only thing to do is
to install the <tt>emir-serp</tt> package from the EMI repository by
executing:</p></div>
<div class="paragraph"><p><tt>yum install emir-serp</tt></p></div>
<div class="paragraph"><p>The package installation will provide the packages that are defined as
dependencies, like python, python-ldap and python-simplejson if they are
not previously installad on the machine.</p></div>
</div>
<h2 id="_emir_server_configuration">4. EMIR Server Configuration</h2>
<div class="sectionbody">
<div class="paragraph"><p>The EMIR server comes with a well documented configuration file (CONF/emir.config), containing a
number of options to setup registry hierarchy, p2p, security, http server, and database. The settings in the configuration file
are pre-defined to start-up the server in a non-production environment, however the administrator needs to review before deploying on the
production (distributed) Grid environments.</p></div>
<h3 id="_general_configuration">4.1. General Configuration</h3><div style="clear:left"></div>
<div class="paragraph"><p>The server configuration options in the CONF/emir.config are:</p></div>
<div class="ulist"><ul>
<li>
<p>
Server address (plain or SSL)
</p>
</li>
<li>
<p>
Settings of the type of the registry node, i.e. whether the current EMIR server instance
           is a child of some other (a parent) EMIR server node or a top/global registry in a hierarchy.
</p>
</li>
</ul></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="hsides"
cellspacing="0" cellpadding="4">
<col width="35%" />
<col width="12%" />
<col width="23%" />
<col width="30%" />
<thead>
<tr>
<th align="left" valign="top">Property name</th>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Default value</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td colspan="4" align="center" valign="top"><p class="table"><em>Server general settings</em></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.address</tt></p></td>
<td align="left" valign="top"><p class="table">string</p></td>
<td align="left" valign="top"><p class="table"><tt>-</tt></p></td>
<td align="left" valign="top"><p class="table">The address/URL of the EMIR server on which it receives registration and query requests. It should either start with http or https (SSL/TLS) mode, if "https" mode is selected the Authentication and Authorisation properties must be properly configured</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.anonymousPort</tt></p></td>
<td align="left" valign="top"><p class="table">Unsigned Integer</p></td>
<td align="left" valign="top"><p class="table"><tt>-</tt></p></td>
<td align="left" valign="top"><p class="table">The anonymous http port number. Setting the property will start an additional <em>http</em> server (without SSL/TLS) only if the above server address is <em>https</em> (with SSL/TLS). It will provide <em>anonymous</em> access to the query interface (i.e. /services REST Web Service).</p></td>
</tr>
</tbody>
</table>
</div>
<h3 id="_pki_trust_settings_configuration">4.2. PKI Trust Settings Configuration</h3><div style="clear:left"></div>
<div class="paragraph"><p>EMIR endorses Public Key Infrastructure (PKI) trust settings to validate certificates using EMI&#8217;s <a href="https://twiki.cern.ch/twiki/bin/view/EMI/EMIcaNl">caNL</a> (JAVA version). The validation is performed
when a connection with a remote peer is initiated over the network, using the SSL (or TLS) protocol, i.e. <tt>emir.address</tt> value has <em>https</em> scheme.</p></div>
<div class="paragraph"><p>Certificates validation is primarily configured using a set of initially trusted certificates of so called
Certificate Authorities (CAs). Those trusted certificates are also known as <em>trust anchors</em> and their collection
is called as a <em>truststore</em>.</p></div>
<div class="paragraph"><p>The validation mechanism except the <em>trust anchors</em> can use additional input for checking if a certificate being checked
was not revoked and if its subject is in a permitted namesapce.</p></div>
<div class="paragraph"><p>EMIR allows different types of truststores. All of them are configured using a set of specific properties in <em>CONF/emir.config</em> file.</p></div>
<h4 id="_openssl_truststore">4.2.1. OpenSSL Truststore</h4>
<div class="paragraph"><p>It allows using a directory with CA certificates stored in PEM format, with precisely
defined names: Certificate Authorities (CA), Certificate Revocation List (CRL), signing policy and namespaces files are named as
&lt;hash&gt;.0, &lt;hash&gt;.r0, &lt;hash&gt;.signing_policy and &lt;hash&gt;.namespaces respectively. Hash is the old hash of the trusted CA certificate
subject name - in OpenSSL version newer than 1.0.0 use -suject_hash_old switch to generate it. If multiple certificates
have the same hash then the default zero number must be incremented. It is suggested when a common truststore with EMI (and Globus)
middlewares is needed.</p></div>
<h4 id="_directory_truststore">4.2.2. Directory Truststore</h4>
<div class="paragraph"><p>It allows to use a list of wildcard expressions, concrete paths of files, or URLs to remote files as a set of trusted
CAs and CRLs. The truststore is configured as a directory containing all the trusted certificates (or with a
specified extension). The directory with stored IGTF trust anchors can be set as a EMIR truststore for instance.</p></div>
<h4 id="_java_keystore_jks_truststore">4.2.3. Java Keystore (JKS) Truststore</h4>
<div class="paragraph"><p>A single repository (or a binary file) of X.509 public key certificates with (optionally) accompanying private key certificates.
The Java JDK already bundles <a href="http://docs.oracle.com/javase/6/docs/technotes/tools/solaris/keytool.html">keytool</a> utility - a certificate manage utility
to create JKS truststores.</p></div>
<h4 id="_pkcs_12_truststore">4.2.4. PKCS#12 Truststore</h4>
<div class="paragraph"><p>Similar to JKS trustore, single binary file can be used to store X.509 public with (optionally) accompanying private key certificates. The <strong>OpenSSL pkcs12</strong>
command can be used to parse, read, and create these files; the extension for PKCS#12 files is ".p12".</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="hsides"
cellspacing="0" cellpadding="4">
<col width="30%" />
<col width="20%" />
<col width="15%" />
<col width="35%" />
<thead>
<tr>
<th align="left" valign="top">Property name </th>
<th align="left" valign="top">Type </th>
<th align="left" valign="top">Default value / mandatory </th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.security.truststore.allowProxy</tt></p></td>
<td align="left" valign="top"><p class="table">[ALLOW, DENY]</p></td>
<td align="left" valign="top"><p class="table"><tt>ALLOW</tt></p></td>
<td align="left" valign="top"><p class="table">Controls whether proxy certificates are supported.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.security.truststore.type</tt></p></td>
<td align="left" valign="top"><p class="table">[keystore, openssl, directory]</p></td>
<td align="left" valign="top"><p class="table"><em>mandatory to be set</em></p></td>
<td align="left" valign="top"><p class="table">The truststore type.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.security.truststore.updateInterval</tt></p></td>
<td align="left" valign="top"><p class="table">integer number</p></td>
<td align="left" valign="top"><p class="table"><tt>600</tt></p></td>
<td align="left" valign="top"><p class="table">How often the truststore should be reloaded, in seconds. Set to negative value to disable refreshing at runtime. <em>(runtime updateable)</em></p></td>
</tr>
<tr>
<td colspan="4" align="center" valign="top"><p class="table"><em>--- Directory type settings ---</em></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.security.truststore.directoryConnectionTimeout</tt></p></td>
<td align="left" valign="top"><p class="table">integer number</p></td>
<td align="left" valign="top"><p class="table"><tt>15</tt></p></td>
<td align="left" valign="top"><p class="table">Connection timeout for fetching the remote CA certificates in seconds.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.security.truststore.directoryDiskCachePath</tt></p></td>
<td align="left" valign="top"><p class="table">filesystem path</p></td>
<td align="left" valign="top"><p class="table">-</p></td>
<td align="left" valign="top"><p class="table">Directory where CA certificates should be cached, after downloading them from a remote source. Can be left undefined if no disk cache should be used. Note that directory should be secured, i.e. normal users should not be allowed to write to it.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.security.truststore.directoryEncoding</tt></p></td>
<td align="left" valign="top"><p class="table">[PEM, DER]</p></td>
<td align="left" valign="top"><p class="table"><tt>PEM</tt></p></td>
<td align="left" valign="top"><p class="table">For directory truststore controls whether certificates are encoded in PEM or DER.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.security.truststore.directoryLocations.*</tt></p></td>
<td align="left" valign="top"><p class="table">list of properties with a common prefix</p></td>
<td align="left" valign="top"><p class="table">-</p></td>
<td align="left" valign="top"><p class="table">List of CA certificates locations. Can contain URLs, local files and wildcard expressions. <em>(runtime updateable)</em></p></td>
</tr>
<tr>
<td colspan="4" align="center" valign="top"><p class="table"><em>--- Keystore type settings ---</em></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.security.truststore.keystoreFormat</tt></p></td>
<td align="left" valign="top"><p class="table">string</p></td>
<td align="left" valign="top"><p class="table">-</p></td>
<td align="left" valign="top"><p class="table">The keystore type (jks, pkcs12) in case of truststore of keystore type.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.security.truststore.keystorePassword</tt></p></td>
<td align="left" valign="top"><p class="table">string</p></td>
<td align="left" valign="top"><p class="table">-</p></td>
<td align="left" valign="top"><p class="table">The password of the keystore type truststore.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.security.truststore.keystorePath</tt></p></td>
<td align="left" valign="top"><p class="table">string</p></td>
<td align="left" valign="top"><p class="table">-</p></td>
<td align="left" valign="top"><p class="table">The keystore path in case of truststore of keystore type.</p></td>
</tr>
<tr>
<td colspan="4" align="center" valign="top"><p class="table"><em>--- Openssl type settings ---</em></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.security.truststore.opensslNsMode</tt></p></td>
<td align="left" valign="top"><p class="table">[GLOBUS_EUGRIDPMA, EUGRIDPMA_GLOBUS, GLOBUS, EUGRIDPMA, GLOBUS_EUGRIDPMA_REQUIRE, EUGRIDPMA_GLOBUS_REQUIRE, GLOBUS_REQUIRE, EUGRIDPMA_REQUIRE, EUGRIDPMA_AND_GLOBUS, EUGRIDPMA_AND_GLOBUS_REQUIRE, IGNORE]</p></td>
<td align="left" valign="top"><p class="table"><tt>EUGRIDPMA_GLOBUS</tt></p></td>
<td align="left" valign="top"><p class="table">In case of openssl truststore, controls which (and in which order) namespace checking rules should be applied. The <em>REQUIRE</em> settings will cause that all configured namespace definitions files must be present for each trusted CA certificate (otherwise checking will fail). The <em>AND</em> settings will cause to check both existing namespace files. Otherwise the first found is checked (in the order defined by the property).</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.security.truststore.opensslPath</tt></p></td>
<td align="left" valign="top"><p class="table">filesystem path</p></td>
<td align="left" valign="top"><p class="table"><tt>/etc/grid-security/certificates</tt></p></td>
<td align="left" valign="top"><p class="table">Directory to be used for opeenssl truststore.</p></td>
</tr>
<tr>
<td colspan="4" align="center" valign="top"><p class="table"><em>--- Revocation settings ---</em></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.security.truststore.crlConnectionTimeout</tt></p></td>
<td align="left" valign="top"><p class="table">integer number</p></td>
<td align="left" valign="top"><p class="table"><tt>15</tt></p></td>
<td align="left" valign="top"><p class="table">Connection timeout for fetching the remote CRLs in seconds (not used for Openssl truststores).</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.security.truststore.crlDiskCachePath</tt></p></td>
<td align="left" valign="top"><p class="table">filesystem path</p></td>
<td align="left" valign="top"><p class="table">-</p></td>
<td align="left" valign="top"><p class="table">Directory where CRLs should be cached, after downloading them from remote source. Can be left undefined if no disk cache should be used. Note that directory should be secured, i.e. normal users should not be allowed to write to it. Not used for Openssl truststores.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.security.truststore.crlLocations.*</tt></p></td>
<td align="left" valign="top"><p class="table">list of properties with a common prefix</p></td>
<td align="left" valign="top"><p class="table">-</p></td>
<td align="left" valign="top"><p class="table">List of CRLs locations. Can contain URLs, local files and wildcard expressions. Not used for Openssl truststores. <em>(runtime updateable)</em></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.security.truststore.crlMode</tt></p></td>
<td align="left" valign="top"><p class="table">[REQUIRE, IF_VALID, IGNORE]</p></td>
<td align="left" valign="top"><p class="table"><tt>IF_VALID</tt></p></td>
<td align="left" valign="top"><p class="table">General CRL handling mode. The IF_VALID setting turns on CRL checking only in case the CRL is present.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.security.truststore.crlUpdateInterval</tt></p></td>
<td align="left" valign="top"><p class="table">integer number</p></td>
<td align="left" valign="top"><p class="table"><tt>600</tt></p></td>
<td align="left" valign="top"><p class="table">How often CRLs should be updated, in seconds. Set to negative value to disable refreshing at runtime. <em>(runtime updateable)</em></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.security.truststore.ocspCacheTtl</tt></p></td>
<td align="left" valign="top"><p class="table">integer number</p></td>
<td align="left" valign="top"><p class="table"><tt>3600</tt></p></td>
<td align="left" valign="top"><p class="table">For how long the OCSP responses should be locally cached in seconds (this is a maximum value, responses won&#8217;t be cached after expiration)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.security.truststore.ocspDiskCache</tt></p></td>
<td align="left" valign="top"><p class="table">filesystem path</p></td>
<td align="left" valign="top"><p class="table">-</p></td>
<td align="left" valign="top"><p class="table">If this property is defined then OCSP responses will be cached on disk in the defined folder.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.security.truststore.ocspLocalResponders.&lt;NUMBER&gt;</tt></p></td>
<td align="left" valign="top"><p class="table">list of properties with a common prefix</p></td>
<td align="left" valign="top"><p class="table">-</p></td>
<td align="left" valign="top"><p class="table">Optional list of local OCSP responders</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.security.truststore.ocspMode</tt></p></td>
<td align="left" valign="top"><p class="table">[REQUIRE, IF_AVAILABLE, IGNORE]</p></td>
<td align="left" valign="top"><p class="table"><tt>IF_AVAILABLE</tt></p></td>
<td align="left" valign="top"><p class="table">General OCSP ckecking mode. REQUIRE should not be used unless it is guaranteed that for all certificates an OCSP responder is defined.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.security.truststore.ocspTimeout</tt></p></td>
<td align="left" valign="top"><p class="table">integer number</p></td>
<td align="left" valign="top"><p class="table"><tt>10000</tt></p></td>
<td align="left" valign="top"><p class="table">Timeout for OCSP connections in miliseconds.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.security.truststore.revocationOrder</tt></p></td>
<td align="left" valign="top"><p class="table">[CRL_OCSP, OCSP_CRL]</p></td>
<td align="left" valign="top"><p class="table"><tt>OCSP_CRL</tt></p></td>
<td align="left" valign="top"><p class="table">Controls overal revocation sources order</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.security.truststore.revocationUseAll</tt></p></td>
<td align="left" valign="top"><p class="table">[true, false]</p></td>
<td align="left" valign="top"><p class="table"><tt>false</tt></p></td>
<td align="left" valign="top"><p class="table">Controls whether all defined revocation sources should be always checked, even if the first one already confirmed that a checked certificate is not revoked.</p></td>
</tr>
</tbody>
</table>
</div>
<h4 id="_examples">4.2.5. Examples</h4>
<div class="paragraph"><p>Directory truststore, with a minimal set of options:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>emir.security.truststore.type=directory
emir.security.truststore.directoryLocations.1=/trust/dir/*.pem
emir.security.truststore.directoryLocations.2=/other/dir/*.pem
emir.security.truststore.crlLocations=/trust/dir/*.crl</tt></pre>
</div></div>
<div class="paragraph"><p>Directory truststore, with complete set of options:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>emir.security.truststore.type=directory
emir.security.truststore.allowProxy=DENY
emir.security.truststore.updateInterval=1234
emir.security.truststore.directoryLocations.1=/trust/dir/*.pem
emir.security.truststore.directoryLocations.2=http://caserver/ca.pem
emir.security.truststore.directoryEncoding=PEM
emir.security.truststore.directoryConnectionTimeout=100
emir.security.truststore.directoryDiskCachePath=/tmp
emir.security.truststore.crlLocations=/trust/dir/*.crl http://caserver/crl.pem
emir.security.truststore.crlUpdateInterval=400
emir.security.truststore.crlMode=REQUIRE
emir.security.truststore.crlConnectionTimeout=200
emir.security.truststore.crlDiskCachePath=/tmp</tt></pre>
</div></div>
<div class="paragraph"><p>Openssl truststore:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>emir.security.truststore.type=openssl
emir.security.truststore.opensslPath=path/to/truststores/openssl
emir.security.truststore.opensslNsMode=EUGRIDPMA_GLOBUS_REQUIRE
emir.security.truststore.allowProxy=ALLOW
emir.security.truststore.updateInterval=1234
emir.security.truststore.crlMode=IF_VALID</tt></pre>
</div></div>
<div class="paragraph"><p>Java keystore used as a truststore:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>emir.security.truststore.type=keystore
emir.security.truststore.keystorePath=path/to/truststores/emir-truststore.jks
emir.security.truststore.keystoreFormat=JKS
emir.security.truststore.keystorePassword=xxxxxx</tt></pre>
</div></div>
<h3 id="_configuring_the_credentials">4.3. Configuring the Credentials</h3><div style="clear:left"></div>
<div class="paragraph"><p>EMIR uses private key and a corresponding certificate (called together as a <em>credential</em>)
to identify clients and servers. The credentials can be provided in several formats. The following table list all possible
variants and corresponding parameters.</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="hsides"
cellspacing="0" cellpadding="4">
<col width="30%" />
<col width="20%" />
<col width="15%" />
<col width="35%" />
<thead>
<tr>
<th align="left" valign="top">Property name </th>
<th align="left" valign="top">Type </th>
<th align="left" valign="top">Default value / mandatory </th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.security.credential.path</tt></p></td>
<td align="left" valign="top"><p class="table">filesystem path</p></td>
<td align="left" valign="top"><p class="table"><em>mandatory to be set</em></p></td>
<td align="left" valign="top"><p class="table">Credential location. In case of <em>jks</em>, <em>pkcs12</em> and <em>pem</em> store it is the only location required. In case when credential is provided in two files, it is the certificate file path.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.security.credential.format</tt></p></td>
<td align="left" valign="top"><p class="table">[jks, pkcs12, der, pem]</p></td>
<td align="left" valign="top"><p class="table">-</p></td>
<td align="left" valign="top"><p class="table">Format of the credential. It is guessed when not given. Note that <em>pem</em> might be either a PEM keystore with certificates and keys (in PEM format) or a pair of PEM files (one with certificate and second with private key).</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.security.credential.password</tt></p></td>
<td align="left" valign="top"><p class="table">string</p></td>
<td align="left" valign="top"><p class="table">-</p></td>
<td align="left" valign="top"><p class="table">Password required to load the credential.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.security.credential.keyPath</tt></p></td>
<td align="left" valign="top"><p class="table">string</p></td>
<td align="left" valign="top"><p class="table">-</p></td>
<td align="left" valign="top"><p class="table">Location of the private key if stored separately from the main credential (applicable for <em>pem</em> and <em>der</em> types only),</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.security.credential.keyPassword</tt></p></td>
<td align="left" valign="top"><p class="table">string</p></td>
<td align="left" valign="top"><p class="table">-</p></td>
<td align="left" valign="top"><p class="table">Private key password, which might be needed only for <em>jks</em> or <em>pkcs12</em>, if key is encrypted with different password then the main credential password.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.security.credential.keyAlias</tt></p></td>
<td align="left" valign="top"><p class="table">string</p></td>
<td align="left" valign="top"><p class="table">-</p></td>
<td align="left" valign="top"><p class="table">Keystore alias of the key entry to be used. Can be ignored if the keystore contains only one key entry. Only applicable for <em>jks</em> and <em>pkcs12</em>.</p></td>
</tr>
</tbody>
</table>
</div>
<h4 id="_examples_2">4.3.1. Examples</h4>
<div class="paragraph"><p>Credential as a pair of DER files:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>emir.security.credential.format=der
emir.security.credential.password=emi
emir.security.credential.path=path/to/credentials/cert-1.der
emir.security.credential.keyPath=path/to/credentials/pk-1.der</tt></pre>
</div></div>
<div class="paragraph"><p>Credential as a JKS file (type can be autodetected in almost every case):</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>emir.security.credential.path=path/to/credentials/server1.jks
emir.security.credential.password=xxxxxx</tt></pre>
</div></div>
<h3 id="_acl_based_authorization">4.4. ACL Based Authorization</h3><div style="clear:left"></div>
<div class="paragraph"><p>The EMIR offers two alternative options to authorise its' clients.</p></div>
<div class="ulist"><ul>
<li>
<p>
Using Access Control List (ACL)
</p>
</li>
<li>
<p>
XACML Policy based authorization
</p>
</li>
</ul></div>
<div class="paragraph"><p>This is the default mechanism to access control the <em>Create</em>,<em>Update</em>, and <em>Delete</em> operations on EMIR&#8217;s SER database. The client SERP or child DSR
registering SERPs with a parent DSR/GSR get authorised while matching it&#8217;s distinguished name (DN) against the pre-defined ACL file (CONF/emir.acl).
Whereas the file contains a list of DN and role pairs, separated by <strong><em>::</em></strong> symbol, see the example below:</p></div>
<div class="paragraph"><p>the property in the <tt>CONF/emir.config</tt> file</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="hsides"
cellspacing="0" cellpadding="4">
<col width="35%" />
<col width="12%" />
<col width="23%" />
<col width="30%" />
<thead>
<tr>
<th align="left" valign="top">Property name</th>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Default value</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.security.accesscontrol.acl</tt></p></td>
<td align="left" valign="top"><p class="table">filesystem path</p></td>
<td align="left" valign="top"><p class="table"><tt>CONF/emir.acl</tt></p></td>
<td align="left" valign="top"><p class="table">The location of the ACL file</p></td>
</tr>
</tbody>
</table>
</div>
<div class="listingblock">
<div class="title">Example ACL file contents</div>
<div class="content">
<pre><tt>emailAddress=emiregistry@user.eu,CN=EMIRegistry-Demo-User,OU=JSC,O=Forschungszentrum Juelich GmbH,L=Juelich,C=DE :: serviceowner
emailAddress=emiregistry@user.eu-admin,CN=EMIRegistry-Demo-User-Admin,OU=JSC,O=Forschungszentrum Juelich GmbH,L=Juelich,C=DE :: admin</tt></pre>
</div></div>
<div class="paragraph"><p>The public key certificate or DN should be sent to the DSR administrator for successfull SER registrations.</p></div>
<div class="paragraph"><p><em>Roles:</em> There are only two pre-defined roles within the scope of ACL file:</p></div>
<div class="ulist"><ul>
<li>
<p>
a user with the <tt>admin</tt> role is considered as a super user who can change any registration, owned by anyone,
</p>
</li>
<li>
<p>
whereas the <tt>serviceowner</tt> is allowed to create or modify the (owned) existing SERPs.
</p>
</li>
</ul></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">The ACL based authorisation is only (and automatically) activated when the DSR/GSR is running on SSL/TLS mode</td>
</tr></table>
</div>
<h3 id="_policy_based_authorization_with_xacml">4.5. Policy Based Authorization with XACML</h3><div style="clear:left"></div>
<div class="paragraph"><p>Using XACML 2.0 is an alternative way to authorise clients (User, EMIR-SERP, DSR, or GSR) in a fine grained manner. The administrator should
review the policies defined in the <tt>CONF/xacml2Policies/</tt> folder and change them according to her infrastructure
needs. However the already defined policies provides a good starting point to the administrators to define/modify the
policies.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">the XACML policy based authorisation will be ignored, if the ACL based authorisation is activated</td>
</tr></table>
</div>
<div class="paragraph"><p>In order to enable the XACML based authorization: attribute sources and policies must be configured.</p></div>
<h4 id="_setting_attribute_sources">4.5.1. Setting Attribute Sources</h4>
<div class="paragraph"><p>EMIR currently supports the file based attribute sources; the client DNs can be included in the attributes file.</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="hsides"
cellspacing="0" cellpadding="4">
<caption class="title">Table 1. File Attribute Source Settings</caption>
<col width="35%" />
<col width="12%" />
<col width="23%" />
<col width="30%" />
<thead>
<tr>
<th align="left" valign="top">Property name</th>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Default value</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.security.attributes.order</tt></p></td>
<td align="left" valign="top"><p class="table">string</p></td>
<td align="left" valign="top"><p class="table"><tt>FILE</tt></p></td>
<td align="left" valign="top"><p class="table">This property is a space separated list of attribute source names, which are then configured in detail below. The named attribute sources are queried in the given order.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.security.attributes.FILE.class</tt></p></td>
<td align="left" valign="top"><p class="table">string</p></td>
<td align="left" valign="top"><p class="table"><tt>eu.emi.emir.aip.FileAttributeSource</tt></p></td>
<td align="left" valign="top"><p class="table">configuration of the <em>FILE</em> attribute source</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.security.attributes.FILE.matching</tt></p></td>
<td align="left" valign="top"><p class="table">[strict, regexp]</p></td>
<td align="left" valign="top"><p class="table"><tt>-</tt></p></td>
<td align="left" valign="top"><p class="table">Specifies the matching or client DNs</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.security.attributes.FILE.file</tt></p></td>
<td align="left" valign="top"><p class="table">filesystem path</p></td>
<td align="left" valign="top"><p class="table"><tt>CONF/users/testUd-strict.xml or CONF/users/testUd-regexp.xml</tt></p></td>
<td align="left" valign="top"><p class="table">The path to the file containing subjects' DNs. The file suffixed with <tt>strict</tt> use strict checking of DNs, whereas the file suffixed with <tt>regexp</tt> contain entries using regualr expressions</p></td>
</tr>
</tbody>
</table>
</div>
<h4 id="_setting_xacml_policies">4.5.2. Setting XACML Policies</h4>
<div class="tableblock">
<table rules="all"
width="100%"
frame="hsides"
cellspacing="0" cellpadding="4">
<caption class="title">Table 2. Policy settings</caption>
<col width="35%" />
<col width="12%" />
<col width="23%" />
<col width="30%" />
<thead>
<tr>
<th align="left" valign="top">Property name</th>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Default value</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.security.accesscontrol.pdpConfig</tt></p></td>
<td align="left" valign="top"><p class="table">filesystem path</p></td>
<td align="left" valign="top"><p class="table"><tt>CONF/xacml2.config</tt></p></td>
<td align="left" valign="top"><p class="table">The path to the XACML2 configuration, containing the rules of executing the policies</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.security.accesscontrol.pdp</tt></p></td>
<td align="left" valign="top"><p class="table">string</p></td>
<td align="left" valign="top"><p class="table"><tt>eu.unicore.uas.pdp.local.LocalHerasafPDP</tt></p></td>
<td align="left" valign="top"><p class="table">The name of the pdp class to endorse, for the xacml2 policies execution</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>The <tt>CONF/xacml2.config</tt> file contains raw xacml polices, enable EMIR (DSR or GSR) administrators to write their own rules.</p></div>
<h3 id="_mongodb_database_configuration">4.6. MongoDB Database Configuration</h3><div style="clear:left"></div>
<div class="paragraph"><p>The EMIR uses MongoDB to store and index the SER collections. It must be configured and running before deploying any EMIR (DSR or GSR) server.</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="hsides"
cellspacing="0" cellpadding="4">
<col width="35%" />
<col width="12%" />
<col width="23%" />
<col width="30%" />
<thead>
<tr>
<th align="left" valign="top">Property name</th>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Default value</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td colspan="4" align="center" valign="top"><p class="table"><em>Connection Settings</em></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.mongodb.hostName</tt></p></td>
<td align="left" valign="top"><p class="table">string</p></td>
<td align="left" valign="top"><p class="table"><tt>localhost</tt></p></td>
<td align="left" valign="top"><p class="table">Fully qualified host name of the machine on which MongoDB is setup</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.mongodb.port</tt></p></td>
<td align="left" valign="top"><p class="table">Integer</p></td>
<td align="left" valign="top"><p class="table"><tt>27017</tt></p></td>
<td align="left" valign="top"><p class="table">The port number</p></td>
</tr>
<tr>
<td colspan="4" align="center" valign="top"><p class="table"><em>Database Settings</em></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.mongodb.dbName</tt></p></td>
<td align="left" valign="top"><p class="table">string</p></td>
<td align="left" valign="top"><p class="table"><tt>emiregistry</tt></p></td>
<td align="left" valign="top"><p class="table">The name of the database to store the SERP records</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.mongodb.colName</tt></p></td>
<td align="left" valign="top"><p class="table">string</p></td>
<td align="left" valign="top"><p class="table"><tt>services</tt></p></td>
<td align="left" valign="top"><p class="table">The name of the collection (of the database) in which the records will be stored</p></td>
</tr>
<tr>
<td colspan="4" align="center" valign="top"><p class="table"><em>Login Settings</em></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.mongodb.userName</tt></p></td>
<td align="left" valign="top"><p class="table">string</p></td>
<td align="left" valign="top"><p class="table"><tt>-</tt></p></td>
<td align="left" valign="top"><p class="table">The username to access the MongoDB database</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.mongodb.password</tt></p></td>
<td align="left" valign="top"><p class="table">string</p></td>
<td align="left" valign="top"><p class="table"><tt>-</tt></p></td>
<td align="left" valign="top"><p class="table">The password to access the MongoDB database</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>For high loads, especially at the GSR level, it is recommended to setup MongoDB <a href="http://www.mongodb.org/display/DOCS/Replication">replication</a> for enhanced scalability and performance.</p></div>
<h3 id="_building_emir_network">4.7. Building EMIR Network</h3><div style="clear:left"></div>
<div class="paragraph"><p>EMIR allows building a network of registries participating in a Grid infrastructure or federation. The network can be of type hierarchical
or Peer-to-Peer (P2P). In an hierarchical network, the SER collections are propagated from leaf DSR node to the top level root node, called GSR.
Each DSR has only one parent, either DSR or GSR to which it pushes it&#8217;s SER collections. At the root level the P2P network of GSR is formed to replicate
the SER collections among multiple GSRs by referring a pre-configured <tt>Global list</tt>. The global list contains a listing of URLs of all the GSRs, each of which should be able to access the URLs.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">The machines running the EMIR servers should be time synchronised, either by NTP or any alternative mechanism</td>
</tr></table>
</div>
<h4 id="_how_to_setup_dsr">4.7.1. How to Setup DSR?</h4>
<div class="paragraph"><p>In order to build hierarchy of DSRs must be able to propagate the SER collections to any <strong>single</strong> parent DSR or a GSR.</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="hsides"
cellspacing="0" cellpadding="4">
<caption class="title">Table 3. Parent DSR Settings</caption>
<col width="35%" />
<col width="12%" />
<col width="23%" />
<col width="30%" />
<thead>
<tr>
<th align="left" valign="top">Property name</th>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Default value</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td colspan="4" align="center" valign="top"><p class="table"><em>EMIR&#8217;s DSR settings</em></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.parentAddress</tt></p></td>
<td align="left" valign="top"><p class="table">string</p></td>
<td align="left" valign="top"><p class="table"><tt>-</tt></p></td>
<td align="left" valign="top"><p class="table">The address/URL (http or https) of the EMIR DSR server to which it propagates its SER collection</p></td>
</tr>
</tbody>
</table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">Add DN of child DSR into the parent DSRs CONF/emir.acl or CONF/users/testUd-(strict | regsexp).xml</td>
</tr></table>
</div>
<h4 id="_how_to_setup_gsr">4.7.2. How to Setup GSR?</h4>
<div class="paragraph"><p>The root level GSR has two primary functions:</p></div>
<div class="ulist"><ul>
<li>
<p>
aggregation of children DSR SER collections
</p>
</li>
<li>
<p>
replicating the SER collections among other GSRs (visible of <em>Global List</em>)
</p>
</li>
</ul></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="hsides"
cellspacing="0" cellpadding="4">
<caption class="title">Table 4. GSR Settings</caption>
<col width="35%" />
<col width="12%" />
<col width="23%" />
<col width="30%" />
<thead>
<tr>
<th align="left" valign="top">Property name</th>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Default value</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td colspan="4" align="center" valign="top"><p class="table"><em>General GSR Settings</em></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.global.enable</tt></p></td>
<td align="left" valign="top"><p class="table">boolean</p></td>
<td align="left" valign="top"><p class="table"><tt>false</tt></p></td>
<td align="left" valign="top"><p class="table">If set to true, indicating the registry node is global. It will then replicate the state among peer global registries (GSRs), the <em>emir.parentAddress</em> property will be ignored (if enabled), as the root registry should not contain any parent.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.global.sparsity</tt></p></td>
<td align="left" valign="top"><p class="table">Unsigned Integer</p></td>
<td align="left" valign="top"><p class="table"><tt>2</tt></p></td>
<td align="left" valign="top"><p class="table">It determines the number of neighbors as a function of the actual number of member nodes of the network.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.global.retry</tt></p></td>
<td align="left" valign="top"><p class="table">Unsigned Integer</p></td>
<td align="left" valign="top"><p class="table"><tt>5</tt></p></td>
<td align="left" valign="top"><p class="table">It specifies a number of attempts if communication to another GSR is failed.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.global.etValid</tt></p></td>
<td align="left" valign="top"><p class="table">Unsigned Integer</p></td>
<td align="left" valign="top"><p class="table"><tt>12</tt></p></td>
<td align="left" valign="top"><p class="table">Specifies period in hours for checking the entries in the soft state database and strip the expired entries (but still keeps them).</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.global.softStateDelay</tt></p></td>
<td align="left" valign="top"><p class="table">Integer</p></td>
<td align="left" valign="top"><p class="table"><tt>2</tt></p></td>
<td align="left" valign="top"><p class="table">Extend the expiration time with this time delay in hours.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.global.etRemove</tt></p></td>
<td align="left" valign="top"><p class="table">Integer</p></td>
<td align="left" valign="top"><p class="table"><tt>24</tt></p></td>
<td align="left" valign="top"><p class="table">Specifies period in hours for checking the entries in the soft state database and remove the expired entries.</p></td>
</tr>
<tr>
<td colspan="4" align="center" valign="top"><p class="table"><em>Global List Settings</em></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.global.providerList</tt></p></td>
<td align="left" valign="top"><p class="table">URL or filesystem path</p></td>
<td align="left" valign="top"><p class="table"><tt>-</tt></p></td>
<td align="left" valign="top"><p class="table">Link to the document listing GSR URLs. The URL(s) is/are important for building the GSR&#8217;s P2P network at the global level.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">Add DN of child DSR into the GSRs CONF/emir.acl or CONF/users/testUd-(strict | regsexp).xml</td>
</tr></table>
</div>
<h3 id="_service_endpoint_record_ser_management">4.8. Service Endpoint Record (SER) Management</h3><div style="clear:left"></div>
<h4 id="_setting_service_endpoint_records_ser_lifetime">4.8.1. Setting Service Endpoint Records (SER) Lifetime</h4>
<div class="paragraph"><p>In EMIR, every SER has associated lifetime or (Time-To-Live) TTL. The settings can be defined in DSR or GSR to restrict the maximum assignable lifetime and assign default lifetime if missing from the registration.</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="hsides"
cellspacing="0" cellpadding="4">
<caption class="title">Table 5. SER TTL Settings</caption>
<col width="35%" />
<col width="12%" />
<col width="23%" />
<col width="30%" />
<thead>
<tr>
<th align="left" valign="top">Property name</th>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Default value</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.record.expiryMaximum</tt></p></td>
<td align="left" valign="top"><p class="table">Unsigned Integer (in days)</p></td>
<td align="left" valign="top"><p class="table"><tt>-</tt></p></td>
<td align="left" valign="top"><p class="table">Maximum assignable lifetime for the SERs containing the Service_ExpireOn property, defined in days, minimum value: 1.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.record.expiryDefault</tt></p></td>
<td align="left" valign="top"><p class="table">Unsigned Integer (in days)</p></td>
<td align="left" valign="top"><p class="table"><tt>-</tt></p></td>
<td align="left" valign="top"><p class="table">The default lifetime will be set from the given property if the incoming registration is without the Service_ExpireOn attribute.</p></td>
</tr>
</tbody>
</table>
</div>
<h4 id="_filtering_service_endpoint_records_ser">4.8.2. Filtering Service Endpoint Records (SER)</h4>
<div class="paragraph"><p>EMIR offers a way to block</p></div>
<div class="ulist"><ul>
<li>
<p>
SERs from being registered via DSR or EMIR-SERP
</p>
</li>
<li>
<p>
SERs from being propagated to it&#8217;s parent DSR or GSR
</p>
</li>
</ul></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="hsides"
cellspacing="0" cellpadding="4">
<caption class="title">Table 6. SER Filter Settings</caption>
<col width="35%" />
<col width="12%" />
<col width="23%" />
<col width="30%" />
<thead>
<tr>
<th align="left" valign="top">Property name</th>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Default value</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.record.blockList.incoming</tt></p></td>
<td align="left" valign="top"><p class="table">filesystem path</p></td>
<td align="left" valign="top"><p class="table"><tt>CONF/inputfilters</tt></p></td>
<td align="left" valign="top"><p class="table">The file containing list of SER IDs, matching services will be blocked from registration to it&#8217;s index</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.record.blockList.outgoing</tt></p></td>
<td align="left" valign="top"><p class="table">filesystem path</p></td>
<td align="left" valign="top"><p class="table"><tt>CONF/outputfilters</tt></p></td>
<td align="left" valign="top"><p class="table">The file containing list of SER IDs, matching services will be blocked from propagation to it&#8217;s parent DSR</p></td>
</tr>
</tbody>
</table>
</div>
<h4 id="_validation_of_mandatory_attributes">4.8.3. Validation of Mandatory Attributes</h4>
<div class="paragraph"><p>Usually the DSR or GSR does not allow the SER to be registered(or updated) without having mandatory attributes.
This validity check can be disabled to allow the publishers to register a SER with custom attributes to
the EMIR server. Hence providing a flexibility to the publishers, whereas the consumers have to examine
all the attributes while performing some operation on the service (contained in the SER) itself.</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="hsides"
cellspacing="0" cellpadding="4">
<caption class="title">Table 7. Enable/Disable Validity Checks</caption>
<col width="35%" />
<col width="12%" />
<col width="23%" />
<col width="30%" />
<thead>
<tr>
<th align="left" valign="top">Property name</th>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Default value</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.record.attributeCheckingMode</tt></p></td>
<td align="left" valign="top"><p class="table">String</p></td>
<td align="left" valign="top"><p class="table"><tt>strict</tt></p></td>
<td align="left" valign="top"><p class="table">There are two possible modes: <em>strict</em> or <em>flexible</em>. If set to <em>strict</em> the emir server will check mandatory attributes in the record being updated or registered. If set to <em>flexible</em> only SERVICE_ENDPOINT_ID will be taken as a mandatory attribute.</p></td>
</tr>
</tbody>
</table>
</div>
<h3 id="_logging_configuration">4.9. Logging Configuration</h3><div style="clear:left"></div>
<div class="paragraph"><p>The EMIR server uses <a href="http://logging.apache.org/log4j/1.2/index.html">log4j</a> to provide log facilities to record all but some of the server activities. In order to
change the logging configuration, CONF/log4j.properties should be reviewed by the administrator.</p></div>
<h3 id="_advanced_http_server_settings">4.10. Advanced HTTP Server Settings</h3><div style="clear:left"></div>
<div class="paragraph"><p>EMIR uses Eclipse&#8217;s Jetty server to host REST Web services. Following table lists the important properties.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">Do not set <strong>emir.jetty.requireClientAuthn</strong> and <strong>emir.jetty.wantClientAuthn</strong>  in CONF/emir.config file, as they are automatically set by the EMIR server on start-up.</td>
</tr></table>
</div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="hsides"
cellspacing="0" cellpadding="4">
<col width="30%" />
<col width="20%" />
<col width="15%" />
<col width="35%" />
<thead>
<tr>
<th align="left" valign="top">Property name </th>
<th align="left" valign="top">Type </th>
<th align="left" valign="top">Default value / mandatory </th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.jetty.disabledCipherSuites</tt></p></td>
<td align="left" valign="top"><p class="table">string</p></td>
<td align="left" valign="top"><p class="table"><em>empty string</em></p></td>
<td align="left" valign="top"><p class="table">Space separated list of SSL cipher suites to be disabled.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.jetty.fastRandom</tt></p></td>
<td align="left" valign="top"><p class="table">[true, false]</p></td>
<td align="left" valign="top"><p class="table"><tt>false</tt></p></td>
<td align="left" valign="top"><p class="table">Use insecure, but fast pseudo random generator to generate session ids instead of secure generator for SSL sockets.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.jetty.gzip.enable</tt></p></td>
<td align="left" valign="top"><p class="table">[true, false]</p></td>
<td align="left" valign="top"><p class="table"><tt>false</tt></p></td>
<td align="left" valign="top"><p class="table">Controls whether to enable compression of HTTP responses.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.jetty.gzip.minGzipSize</tt></p></td>
<td align="left" valign="top"><p class="table">integer number</p></td>
<td align="left" valign="top"><p class="table"><tt>100000</tt></p></td>
<td align="left" valign="top"><p class="table">Specifies the minimal size of message that should be compressed.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.jetty.highLoadConnections</tt></p></td>
<td align="left" valign="top"><p class="table">integer &gt;= 1</p></td>
<td align="left" valign="top"><p class="table"><tt>200</tt></p></td>
<td align="left" valign="top"><p class="table">If the number of connections exceeds this amount, then the connector is put into a special <em>low on resources</em> state. Existing connections will be closed faster. Note that this value is honored only for NIO connectors. Legacy connectors go into low resources mode when no more threads are available.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.jetty.lowResourceMaxIdleTime</tt></p></td>
<td align="left" valign="top"><p class="table">integer &gt;= 1</p></td>
<td align="left" valign="top"><p class="table"><tt>100</tt></p></td>
<td align="left" valign="top"><p class="table">In low resource conditions, time (in ms.) before an idle connection will time out.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.jetty.maxIdleTime</tt></p></td>
<td align="left" valign="top"><p class="table">integer &gt;= 1</p></td>
<td align="left" valign="top"><p class="table"><tt>200000</tt></p></td>
<td align="left" valign="top"><p class="table">Time (in ms.) before an idle connection will time out. It should be large enough not to expire connections with slow clients, values below 30s are getting quite risky.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.jetty.maxThreads</tt></p></td>
<td align="left" valign="top"><p class="table">integer &gt;= 1</p></td>
<td align="left" valign="top"><p class="table"><tt>255</tt></p></td>
<td align="left" valign="top"><p class="table">Maximum number of threads to have in the thread pool for processing HTTP connections.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.jetty.minThreads</tt></p></td>
<td align="left" valign="top"><p class="table">integer &gt;= 1</p></td>
<td align="left" valign="top"><p class="table"><tt>1</tt></p></td>
<td align="left" valign="top"><p class="table">Minimum number of threads to have in the thread pool for processing HTTP connections.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.jetty.requireClientAuthn</tt></p></td>
<td align="left" valign="top"><p class="table">[true, false]</p></td>
<td align="left" valign="top"><p class="table"><tt>true</tt></p></td>
<td align="left" valign="top"><p class="table">Controls whether the SSL socket requires client-side authentication.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.jetty.soLingerTime</tt></p></td>
<td align="left" valign="top"><p class="table">integer number</p></td>
<td align="left" valign="top"><p class="table"><tt>-1</tt></p></td>
<td align="left" valign="top"><p class="table">Socket linger time.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.jetty.useNIO</tt></p></td>
<td align="left" valign="top"><p class="table">[true, false]</p></td>
<td align="left" valign="top"><p class="table"><tt>false</tt></p></td>
<td align="left" valign="top"><p class="table">Controls whether the NIO connector be used. NIO is best suited under high-load, when lots of connections exist that are idle for long periods.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>emir.jetty.wantClientAuthn</tt></p></td>
<td align="left" valign="top"><p class="table">[true, false]</p></td>
<td align="left" valign="top"><p class="table"><tt>true</tt></p></td>
<td align="left" valign="top"><p class="table">Controls whether the SSL socket accepts (but does not require) client-side authentication.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<h2 id="_emir_serp_configuration">5. EMIR-SERP Configuration</h2>
<div class="sectionbody">
<div class="paragraph"><p><a id="anchor-emir-serpd-config"></a></p></div>
<div class="paragraph"><p>The configuration of EMIR-SERP can be performed by editing its configuration
file or files. The configuration can be found basically in one file
that default location is <tt>/etc/emi/emir-serp/emir-serp.ini</tt>.</p></div>
<div class="paragraph"><p>This file contains every configuration options that can be the EMIR-SERP daemon
control by, like <em>service url</em>, <em>logging verbosity</em>, <em>credential
location</em>, etc.</p></div>
<div class="paragraph"><p>The advanced service entries to be propagated can be described in
separated configuration files preferably also under this directory and
use to have <tt>.json</tt> extension.</p></div>
<div class="paragraph"><p>The main configuration file has INI format. The <tt>emir-serp</tt> section contains
the daemon scoped options while the others are to describe the different
service entries to be registered. In these cases the exact name is
indifferent, they just have to differ from each other and must avoid the
<tt>emir-serp</tt> name as well.</p></div>
<h3 id="_configuration_options">5.1. Configuration options</h3><div style="clear:left"></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph"><p>The names of options are case-insensitive.</p></div>
</td>
</tr></table>
</div>
<h4 id="_url">5.1.1. url</h4>
<div class="paragraph"><p><tt>Location:</tt> <tt>emir-serp</tt> section</p></div>
<div class="paragraph"><p><tt>Default value:</tt> <em>No default value</em></p></div>
<div class="paragraph"><p><tt>Mandatory:</tt> Yes</p></div>
<div class="paragraph"><p><tt>Description:</tt></p></div>
<div class="paragraph"><p>URL of the EMIR service to connect in a protocol://domain:port format.</p></div>
<div class="paragraph"><p>If protocol is missing default <tt>https</tt> is used.
If port is missing default <tt>54321</tt> is used.
The domain part is mandatory.</p></div>
<div class="listingblock">
<div class="title">Examples</div>
<div class="content">
<pre><tt>url = emiregistry2.grid.niif.hu
url = https://emiregistry2.grid.niif.hu
url = https://emiregistry2.grid.niif.hu:54321</tt></pre>
</div></div>
<h4 id="_period">5.1.2. period</h4>
<div class="paragraph"><p><tt>Location:</tt> <tt>emir-serp</tt> section</p></div>
<div class="paragraph"><p><tt>Default value:</tt> <em>No default value</em></p></div>
<div class="paragraph"><p><tt>Mandatory:</tt> Yes</p></div>
<div class="paragraph"><p><tt>Description:</tt></p></div>
<div class="paragraph"><p>The period of the registration/update messages. Its value is given in
hours.</p></div>
<h4 id="_validity">5.1.3. validity</h4>
<div class="paragraph"><p><tt>Location:</tt> <tt>emir-serp</tt> section</p></div>
<div class="paragraph"><p><tt>Default value:</tt> <em>No default value</em></p></div>
<div class="paragraph"><p><tt>Mandatory:</tt> Yes</p></div>
<div class="paragraph"><p><tt>Description:</tt></p></div>
<div class="paragraph"><p>The validity of the registration entries. Its value is given in hours.</p></div>
<h4 id="_cert">5.1.4. cert</h4>
<div class="paragraph"><p><tt>Location:</tt> <tt>emir-serp</tt> section</p></div>
<div class="paragraph"><p><tt>Default value:</tt> /etc/grid-security/hostcert.pem</p></div>
<div class="paragraph"><p><tt>Mandatory:</tt> No</p></div>
<div class="paragraph"><p><tt>Description:</tt></p></div>
<div class="paragraph"><p>User certificate file location in PEM format. Only used and checked if the protocol in
the url option is <em>https</em>.</p></div>
<h4 id="_key">5.1.5. key</h4>
<div class="paragraph"><p><tt>Location:</tt> <tt>emir-serp</tt> section</p></div>
<div class="paragraph"><p><tt>Default value:</tt> /etc/grid-security/hostkey.pem</p></div>
<div class="paragraph"><p><tt>Mandatory:</tt> No</p></div>
<div class="paragraph"><p><tt>Description:</tt></p></div>
<div class="paragraph"><p>User key file location in PEM format. Only used and checked if the protocol in
the url option is <em>https</em>.</p></div>
<h4 id="_cadir">5.1.6. cadir</h4>
<div class="paragraph"><p><tt>Location:</tt> <tt>emir-serp</tt> section</p></div>
<div class="paragraph"><p><tt>Default value:</tt> /etc/grid-security/certificates</p></div>
<div class="paragraph"><p><tt>Mandatory:</tt> No</p></div>
<div class="paragraph"><p><tt>Description:</tt></p></div>
<div class="paragraph"><p>A path pointing to the store where the PEM certificate of the trusted
Certificate Authorities can be found. Only used and checked if the protocol in
the url option is <em>https</em>.</p></div>
<h4 id="_verbosity">5.1.7. verbosity</h4>
<div class="paragraph"><p><tt>Location:</tt> <tt>emir-serp</tt> section</p></div>
<div class="paragraph"><p><tt>Default value:</tt> error</p></div>
<div class="paragraph"><p><tt>Mandatory:</tt> No</p></div>
<div class="paragraph"><p><tt>Description:</tt></p></div>
<div class="paragraph"><p>Logging verbosity. The parameter is optional. If missing or an invalid
value is given, the default value will be used. The logs are written
into the log file that can be found in the <em>/var/log/emi/emir-serp</em>
directory by default.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph"><p>The service entries can be defined in separated ini sections. The name
of the section is irrelevant but must be different in every cases!</p></div>
<div class="paragraph"><p>Any of <em>json_file_location</em>, <em>json_dir_location</em> or <em>resource_bdii_url</em>
must be present in a section to enable EMIR-SERP registration otherwise
section is going to be skipped.</p></div>
</td>
</tr></table>
</div>
<h4 id="_json_file_location">5.1.8. json_file_location</h4>
<div class="paragraph"><p><tt>Location:</tt> service related section</p></div>
<div class="paragraph"><p><tt>Default value:</tt> <em>No default value</em></p></div>
<div class="paragraph"><p><tt>Mandatory:</tt> Yes</p></div>
<div class="paragraph"><p><tt>Description:</tt></p></div>
<div class="paragraph"><p>The service entry can be defined in a single external json formatted file
per service. Any allowed json attributes are allowed in this way. The
location of this file must be defined in the <em>json_file_location</em> ini
variable.</p></div>
<div class="paragraph"><p>The value of <tt>json_file_location</tt> is used only if no <tt>resource_bdii_url</tt> or
<tt>json_dir_location</tt> are present in the same section.</p></div>
<h4 id="_json_dir_location">5.1.9. json_dir_location</h4>
<div class="paragraph"><p><tt>Location:</tt> service related section</p></div>
<div class="paragraph"><p><tt>Default value:</tt> <em>No default value</em></p></div>
<div class="paragraph"><p><tt>Mandatory:</tt> Yes</p></div>
<div class="paragraph"><p><tt>Description:</tt></p></div>
<div class="paragraph"><p>Multiple entries belonging to a service can be put into separated json
files in a common directory. The script periodically scan the content
of the directory setted up with this attribute and the content of the
found json files will be propagated to the EMIR service.</p></div>
<div class="paragraph"><p>The value of <tt>json_dir_location</tt> is used  only if no <tt>resource_bdii_url</tt> is
present.</p></div>
<h4 id="_resource_bdii_url">5.1.10. resource_bdii_url</h4>
<div class="paragraph"><p><tt>Location:</tt> service related section</p></div>
<div class="paragraph"><p><tt>Default value:</tt> <em>No default value</em></p></div>
<div class="paragraph"><p><tt>Mandatory:</tt> Yes</p></div>
<div class="paragraph"><p><tt>Description:</tt></p></div>
<div class="paragraph"><p>The service information to be registered can be harvested from directly
from resource BDII LDAP servers. EMIR-SERP periodically queries the
remote database, converts the result, and publish the service information
to the previously configured EMIR service.</p></div>
<div class="paragraph"><p>If <em>resource_bdii_url</em> attribute is present both <em>json_dir_location</em> and
<em>json_file_location</em> are ignored.</p></div>
<div class="paragraph"><p>If port is missing default 2170 is used.
If LDAP base is missing default <em>o=glue</em> is used.
Only <em>ldap</em> scheme is accepted in the URL.</p></div>
</div>
<h2 id="_how_to_use_emir_api">6. How to use EMIR API?</h2>
<div class="sectionbody">
<div class="paragraph"><p>The EMI Registry allows Services to register/publish their capabilities
while the Service Consumers are able to find the deployed services.</p></div>
<div class="paragraph"><p>This section contains the description of the REST-ful interface, that allows the
management of the service information (or entries) by exposing the individual
URIs. The normative description of the API cab also be defined as Web Application Description Language (WADL) document <a href="#appendixii">WADL</a>.</p></div>
<h3 id="_creatung_or_updating_the_service_endpoint_records">6.1. Creatung OR Updating the Service Endpoint Records</h3><div style="clear:left"></div>
<div class="paragraph"><p><tt>HTTP Method</tt> : PUT</p></div>
<div class="paragraph"><p><tt>URI</tt> : /serviceadmin</p></div>
<div class="paragraph"><p><tt>Content Type</tt> : application/json</p></div>
<div class="paragraph"><p><tt>Security Implications</tt> : Requires an authenticated "and" authorized client&#8217;s access to perform this operation</p></div>
<h4 id="_request">6.1.1. Request</h4>
<div class="paragraph"><p>The request body contain a similar JSON array object as defined in <a href="#appendixi">[appendixi]</a>, it contains
description of the Services to be updated or created. The endpoint records will be updated automatically,
 if the JSON document in the request body is already existing. The operation takes place only after the
 successful authentication and authorisation checks.</p></div>
<h4 id="_response">6.1.2. Response</h4>
<div class="paragraph"><p>The response contains an array of JSON Objects as it was sent in the request, confirming the successful update.</p></div>
<div class="paragraph"><p><tt>Status Code</tt> : OK / 200</p></div>
<h3 id="_delete_existing_services">6.2. Delete existing Services</h3><div style="clear:left"></div>
<div class="paragraph"><p><tt>HTTP Method</tt> : DELETE</p></div>
<div class="paragraph"><p><tt>URI</tt> : /serviceadmin</p></div>
<div class="paragraph"><p><tt>Security Implications</tt> : Requires an authenticated "and" authorized user access to perform this operation</p></div>
<h4 id="_request_2">6.2.1. Request</h4>
<div class="paragraph"><p>The Service Entry matching the Endpoint ID will be deleted from the
registry only if the client executing the action has authorised access and the
method is allowed by the security plugins.</p></div>
<div class="paragraph"><p><tt>URL Query Parameters</tt> : Service_Endpoint_ID= <em>&lt;Service Endpoint ID&gt;</em></p></div>
<div class="sidebarblock">
<div class="sidebar-content">
<div class="paragraph"><p><strong>Example</strong> : /serviceadmin?Service_Endpoint_ID=urn:endpoint:emi1</p></div>
</div></div>
<h4 id="_response_2">6.2.2. Response</h4>
<div class="paragraph"><p><tt>Status Code</tt> : OK / 200</p></div>
<h3 id="_query_for_endpoint_information">6.3. Query for Endpoint Information</h3><div style="clear:left"></div>
<div class="paragraph"><p><tt>HTTP Method</tt> : GET</p></div>
<div class="paragraph"><p><tt>URI</tt> : /services</p></div>
<div class="paragraph"><p><tt>Content Type</tt> : application/json</p></div>
<h4 id="_request_3">6.3.1. Request</h4>
<div class="paragraph"><p>The request contains the key-value pairs separated by ampersand <tt>&amp;</tt></p></div>
<div class="paragraph"><p><tt>Query Parameters</tt> : AttributeName=&lt;Attribute_Value&gt;&amp;AttributeName=&lt;Attribute_Value&gt;&amp;&#8230;</p></div>
<div class="sidebarblock">
<div class="sidebar-content">
<div class="paragraph"><p><strong>Example</strong> : /services?Service_Type=eu.emi.es&amp;Service_Endpoint_HealthState=ok</p></div>
</div></div>
<div class="paragraph"><p>The response contains an array of service entries packed in a JSON array object</p></div>
<div class="paragraph"><p><tt>Status Code</tt> : OK / 200</p></div>
<h3 id="_rich_querying_in_emir">6.4. Rich Querying in EMIR</h3><div style="clear:left"></div>
<div class="paragraph"><p><tt>HTTP Method</tt> : GET</p></div>
<div class="paragraph"><p><tt>URI</tt> : /services</p></div>
<div class="paragraph"><p><tt>Content Type</tt> : application/json</p></div>
<h4 id="_request_4">6.4.1. Request</h4>
<div class="paragraph"><p>The request contains the JSON document including with support for defining advanced clauses, the
<a href="http://www.mongodb.org/display/DOCS/Advanced+Queries">http://www.mongodb.org/display/DOCS/Advanced+Queries</a>, MongoDB Advanced Queries[MongoDB JSON Query Language] describes the various types of queries</p></div>
<div class="paragraph"><p>Additional keys (skip, limit) can also be added to paginate the returning results.</p></div>
<h4 id="_response_3">6.4.2. Response</h4>
<div class="paragraph"><p>The response contains the array of service entries packed in a JSON array object</p></div>
<div class="paragraph"><p><tt>Status Code</tt> : OK / 200</p></div>
<h3 id="_querying_the_emir_for_glue_2_0_xml_documents">6.5. Querying the EMIR for GLUE 2.0 XML Documents</h3><div style="clear:left"></div>
<div class="paragraph"><p><tt>HTTP Method</tt> : GET</p></div>
<div class="paragraph"><p><tt>URI</tt> : /services</p></div>
<div class="paragraph"><p><tt>Content Type</tt> : application/xml</p></div>
<h4 id="_request_5">6.5.1. Request</h4>
<div class="paragraph"><p>The request contains the key-value pairs separated by ampersand <tt>&amp;</tt></p></div>
<div class="paragraph"><p><tt>Query Parameters</tt> : AttributeName=&lt;Attribute_Value&gt;&amp;AttributeName=&lt;Attribute_Value&gt;&amp;&#8230;</p></div>
<div class="sidebarblock">
<div class="sidebar-content">
<div class="paragraph"><p><strong>Example</strong> : /services?Service_Type=eu.emi.es&amp;Service_Endpoint_HealthState=ok</p></div>
</div></div>
<h4 id="_response_4">6.5.2. Response</h4>
<div class="paragraph"><p>The response contains an XML document containing service entries in GLUE 2.0 format</p></div>
<div class="paragraph"><p><tt>Status Code</tt> : OK / 200</p></div>
<h3 id="_rich_querying_the_emir_for_glue_2_0_xml_documents">6.6. Rich Querying the EMIR for GLUE 2.0 XML Documents</h3><div style="clear:left"></div>
<div class="paragraph"><p>The request and response interface is same as defined above, however the content type must be
defined as <strong>application/xml</strong> instead.</p></div>
<h3 id="_traversing_through_query_results">6.7. Traversing through Query Results</h3><div style="clear:left"></div>
<div class="paragraph"><p>It is very likely that a client (plain or rich) query can evaluate to a huge number of result set,
which may result in memory over-flow and delayed response. In order to make the listing scalable and
faster response times of the query requests, a traversal mechanism has been implemented
at the Web services as well as JAVA client layer. It allows a client to provide specific query parameters,
while offering the two alternative ways, thus highly depending on the size of EMIR index.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph"><p>The same iterating parameters can be used for the available query methods,
such as, with query parameters or rich querying</p></div>
</td>
</tr></table>
</div>
<h4 id="_using_tt_skip_tt_and_tt_limit_tt_query_parameters">6.7.1. Using <tt>skip</tt> and <tt>limit</tt> Query Parameters</h4>
<div class="paragraph"><p><strong>skip</strong> defines an offset or a number of records to be skipped from the query result</p></div>
<div class="paragraph"><p><strong>limit</strong> defines a total number of resulting endpoints expected from the query</p></div>
<div class="paragraph"><p>Following example illustrates this method of traversal:</p></div>
<h5 id="_request_6">Request</h5>
<div class="paragraph"><p><tt>GET / POST:</tt>           /services/?skip=&lt;Non-Negative Number&gt;&amp;limit=&lt;Non-Negative Number&gt;</p></div>
<div class="paragraph"><p><em>Example Usage:</em>        <a href="https://emir.example.org/services?skip=10&amp;limit=100">https://emir.example.org/services?skip=10&amp;limit=100</a></p></div>
<div class="paragraph"><p><tt>Content-Type:</tt>         application/json OR application/xml</p></div>
<h5 id="_response_5">Response</h5>
<div class="paragraph"><p>An array of matching endpoint records, either in a JSON or an XML format depending on the Content-Type header</p></div>
<div class="sidebarblock">
<div class="sidebar-content">
<div class="paragraph"><p>This method is suitable when size of endpoint records
stored in the EMIR server is not larger than 1000.</p></div>
</div></div>
<h4 id="_using_tt_pagesize_tt_and_tt_ref_tt_query_parameters">6.7.2. Using <tt>pageSize</tt> and <tt>ref</tt> Query Parameters</h4>
<div class="paragraph"><p>Being a memory efficient and robust, this method is ought to be the most preferable way of traversing the
endpoint records.</p></div>
<div class="paragraph"><p><strong>pageSize</strong> defines a total number of resulting endpoint records expected from a query</p></div>
<div class="paragraph"><p><strong>ref</strong> every returned page contains a reference or pointer to the next page for further traversal</p></div>
<div class="paragraph"><p>Following example illustrates this method of traversal:</p></div>
<h5 id="_request_7">Request</h5>
<div class="paragraph"><p><tt>GET / POST:</tt>           /services/pageSize=&lt;Non-Negative Number&gt;&amp;ref=&lt;String&gt;</p></div>
<div class="paragraph"><p><em>Example Usage:</em>        <a href="https://emir.example.org/services?pageSize=10&amp;ref=87701693-ca33-482c-bbf4-843f9952e012">https://emir.example.org/services?pageSize=10&amp;ref=87701693-ca33-482c-bbf4-843f9952e012</a></p></div>
<div class="paragraph"><p><tt>Content-Type:</tt>                 application/json OR application/xml</p></div>
<h5 id="_response_6">Response</h5>
<div class="paragraph"><p>An array of matching endpoint records, either in a JSON or an XML format depending on the Content-Type header</p></div>
<h3 id="_faceted_search">6.8. Faceted Search</h3><div style="clear:left"></div>
<div class="paragraph"><p>The EMIR offers a remote interface to faceted search based on the endpoint attributes. The purpose of the
feature is to get the frequency (or count) of endpoint attribute&#8217;s values.The request is using simple URL
query parameters to the <tt>/services/facet</tt> URI. Furthermore, the query is attribute type specific, the
query parameters should specify the type while sending the request. The response of the faceted query contains
requested attributes and associated values with frequency.</p></div>
<h5 id="_request_8">Request</h5>
<div class="paragraph"><p><tt>GET:</tt>                          /services/facet?&lt;Attribute Name&gt;:(facet.simple|facet.type)</p></div>
<div class="paragraph"><p>Example showing the faceted search for two different types of attributes: simple <tt>Service_Type</tt>, <tt>Service_Endpoint_Capabilities</tt></p></div>
<div class="paragraph"><p><em>Example Usage:</em>        <a href="https://emir.example.org/services/facet?Service_Type=facet.simple&amp;Service_Endpoint_Capabilities=facet.array">https://emir.example.org/services/facet?Service_Type=facet.simple&amp;Service_Endpoint_Capabilities=facet.array</a></p></div>
<h5 id="_response_7">Response</h5>
<div class="paragraph"><p>The response contains a JSON array containing the Attributes grouped by their values and their frequency of
occurrence.</p></div>
<div class="listingblock">
<div class="title">Example Facet Response</div>
<div class="content">
<pre><tt>[
  {"Service_Type": [
    {
      "_id": "jms",
      "count": 25
    },
    {
      "_id": "sms",
      "count": 53
    }
  ]},
  {"Service_Endpoint_Capability": [
    {
      "_id": "emi.es",
      "count": 100
    },
    {
      "_id": "arc.arex",
      "count": 75
    },
    {
      "_id": "ogf.glue",
      "count": 25
    }
  ]}
]</tt></pre>
</div></div>
<h3 id="_viewing_the_service_information_template">6.9. Viewing the Service information template</h3><div style="clear:left"></div>
<div class="paragraph"><p>This To view the GLUE 2.0&#8217;s JSON flavored service model.</p></div>
<div class="paragraph"><p><tt>HTTP Method</tt> : GET</p></div>
<div class="paragraph"><p><tt>URI</tt> : /model</p></div>
<div class="paragraph"><p><tt>Content Type</tt> : application/json</p></div>
<h4 id="_request_9">6.9.1. Request</h4>
<div class="paragraph"><p>N/A</p></div>
<h4 id="_response_8">6.9.2. Response</h4>
<div class="paragraph"><p>A JSON document containing all the mandatory and optional attribute</p></div>
<h3 id="_information_about_the_deployed_emir_server">6.10. Information about the Deployed EMIR Server</h3><div style="clear:left"></div>
<div class="paragraph"><p>There is an Web services interface to query the EMIR server&#8217;s status in JSON format. This specifically
contains the following attributes:</p></div>
<div class="ulist"><ul>
<li>
<p>
EMIRServerVersion
</p>
</li>
<li>
<p>
MongoDBVersion
</p>
</li>
<li>
<p>
JavaVersion
</p>
</li>
<li>
<p>
OSName
</p>
</li>
<li>
<p>
OSArchitecture
</p>
</li>
<li>
<p>
OSVersion
</p>
</li>
<li>
<p>
EMIRServerComponentName
</p>
</li>
<li>
<p>
AnonymousAccessPortNumber
</p>
</li>
<li>
<p>
RunningSince
</p>
</li>
<li>
<p>
NumberofEntries
</p>
</li>
</ul></div>
<div class="paragraph"><p><tt>HTTP Method</tt>: GET</p></div>
<div class="paragraph"><p><tt>URI</tt>: /status</p></div>
<div class="paragraph"><p><tt>Content-Type</tt>: application/json</p></div>
<h4 id="_request_10">6.10.1. Request</h4>
<div class="paragraph"><p>N/A</p></div>
<h4 id="_response_9">6.10.2. Response</h4>
<div class="paragraph"><p>A JSON document containing the aforementioned attributes</p></div>
<div class="paragraph"><p><tt>Status Code</tt> : OK / 200</p></div>
<div class="listingblock">
<div class="title">Example Status Information</div>
<div class="content">
<pre><tt>{
  "EMIRServerVersion":"1.2.2-SNAPSHOT",
  "MongoDBVersion":"2.0.4",
  "JavaVersion":"1.6.0_24",
  "OSName":"Linux",
  "OSArchitecture":"amd64",
  "OSVersion":"2.6.37.6-0.11-xen",
  "EMIRServerComponentName":"Domain Service Registry (DSR)",
  "AnonymousAccessPortNumber":"9127",
  "RunningSince":"Fri Jun 14 17:49:53 CEST 2013",
  "NumberofEntries":279
}</tt></pre>
</div></div>
</div>
<h2 id="appendixi">7. Appendix I</h2>
<div class="sectionbody">
<div class="paragraph"><p>An example JSON document representing the Service endpoint records.</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>[       //Example Service Endpoints Records (belonging to the same service)
        {
                "Service_ID":"s1",
                "Service_Name":"ComputingService",
                "Service_CreationTime":{"$date":"2011-07-21T11:47:24Z"},
                "Service_Type":"job-management",
                "Service_Contact": [{"ContactType":"sysadmin", "Detail":"http://contactlink"},{"ContactType":"developer", "Detail":"http://contactlink"}],
                "Service_Endpoint_ID":"se1", //this should be unique
                "Service_Endpoint_URL":"http://1",
                "Service_Endpoint_Capability":["capability1","capability2"],
                "Service_Endpoint_Technology":"technology",
                "Service_Endpoint_InterfaceName":"interface",
                "Service_Endpoint_InterfaceVersion":["version1","version2"],
                "Service_Endpoint_InterfaceExtension":["extension1","extension2"],
                "Service_Endpoint_WSDL":"http//1.wsdl",
                "Service_Endpoint_SupportedProfile":["profile1","profile2"],
                "Service_Endpoint_Semantics":["semantic1","semantic2"],
                "Service_Endpoint_HealthState":"ok",
                "Service_Endpoint_HealthStateInfo":"state info",
                "Service_Endpoint_ServingState":"production",
                "Service_Endpoint_StartTime":{"$date":"2011-07-21T11:47:24Z"},
                "Service_Endpoint_DowntimeAnnounce":{"$date":"2011-07-21T11:47:24Z"},
                "Service_Endpoint_DowntimeStart":{"$date":"2011-07-21T11:47:24Z"},
                "Service_Endpoint_DowntimeEnd":{"$date":"2011-07-21T11:47:24Z"},
                "Service_Endpoint_QualityLevel":"production",
                "Service_Location_Address":"A Street 1",
                "Service_Location_Place":"Bonn",
                "Service_Location_Country":"Germany",
                "Service_Location_PostCode":"53119",
                "Service_Location_Latitude":53.3,
                "Service_Location_Longitude":4,
                "Service_ExpireOn":{"$date":"2020-07-21T11:47:24Z"}

        },
        {
                "Service_ID":"s1",
                "Service_Name":"ComputingService",
                "Service_CreationTime":{"$date":"2011-07-21T11:47:24Z"},
                "Service_Type":"job-management",
                "Service_Contact": [{"ContactType":"sysadmin", "Detail":"http://contactlink"},{"ContactType":"developer", "Detail":"http://contactlink"}],
                "Service_Endpoint_ID":"se2", //this should be unique
                "Service_Endpoint_URL":"http://1",
                "Service_Endpoint_Capability":["capability1","capability2"],
                "Service_Endpoint_Technology":"technology",
                "Service_Endpoint_InterfaceName":"interface",
                "Service_Endpoint_InterfaceVersion":["version1","version2"],
                "Service_Endpoint_InterfaceExtension":["extension1","extension2"],
                "Service_Endpoint_WSDL":"http//1.wsdl",
                "Service_Endpoint_SupportedProfile":["profile1","profile2"],
                "Service_Endpoint_Semantics":["semantic1","semantic2"],
                "Service_Endpoint_HealthState":"ok",
                "Service_Endpoint_HealthStateInfo":"state info",
                "Service_Endpoint_ServingState":"production",
                "Service_Endpoint_StartTime":{"$date":"2011-07-21T11:47:24Z"},
                "Service_Endpoint_DowntimeAnnounce":{"$date":"2011-07-21T11:47:24Z"},
                "Service_Endpoint_DowntimeStart":{"$date":"2011-07-21T11:47:24Z"},
                "Service_Endpoint_DowntimeEnd":{"$date":"2011-07-21T11:47:24Z"},
                "Service_Endpoint_QualityLevel":"production",
                "Service_Location_Address":"A Street 1",
                "Service_Location_Place":"Berlin",
                "Service_Location_Country":"Germany",
                "Service_Location_PostCode":"53011",
                "Service_Location_Latitude":53.5,
                "Service_Location_Longitude":4,
                "Service_ExpireOn":{"$date":"2020-07-21T11:47:24Z"}
        }

]</tt></pre>
</div></div>
</div>
<h2 id="appendixii">8. Appendix II</h2>
<div class="sectionbody">
<div class="paragraph"><p>The normative form of the EMIR REST-ful API in Web Application Description Language (WADL)</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;application xmlns="http://wadl.dev.java.net/2009/02"&gt;
        &lt;doc xmlns:jersey="http://jersey.java.net/" jersey:generatedBy="Jersey: 1.17 01/17/2013 03:31 PM" /&gt;
        &lt;grammars /&gt;
        &lt;resources base="https://localhost:54321/"&gt;
                &lt;resource path="/status"&gt;
                        &lt;method id="getServerStatus" name="GET"&gt;
                                &lt;response&gt;
                                        &lt;representation mediaType="application/json" /&gt;
                                        &lt;representation mediaType="text/plain" /&gt;
                                &lt;/response&gt;
                        &lt;/method&gt;
                &lt;/resource&gt;
                &lt;resource path="/parent"&gt;
                        &lt;method id="childDSRs" name="GET"&gt;
                                &lt;response&gt;
                                        &lt;representation mediaType="*/*" /&gt;
                                &lt;/response&gt;
                        &lt;/method&gt;
                &lt;/resource&gt;
                &lt;resource path="/ping"&gt;
                        &lt;method id="ping" name="GET"&gt;
                                &lt;response&gt;
                                        &lt;representation mediaType="application/json" /&gt;
                                        &lt;representation mediaType="text/plain" /&gt;
                                &lt;/response&gt;
                        &lt;/method&gt;
                &lt;/resource&gt;
                &lt;resource path="/serviceadmin"&gt;
                        &lt;method id="getServicebyID" name="GET"&gt;
                                &lt;response&gt;
                                        &lt;representation mediaType="application/json" /&gt;
                                &lt;/response&gt;
                        &lt;/method&gt;
                        &lt;method id="registerServices" name="POST"&gt;
                                &lt;request&gt;
                                        &lt;representation mediaType="application/json" /&gt;
                                &lt;/request&gt;
                                &lt;response&gt;
                                        &lt;representation mediaType="application/json" /&gt;
                                &lt;/response&gt;
                        &lt;/method&gt;
                        &lt;method id="updateServices" name="PUT"&gt;
                                &lt;request&gt;
                                        &lt;representation mediaType="application/json" /&gt;
                                &lt;/request&gt;
                                &lt;response&gt;
                                        &lt;representation mediaType="application/json" /&gt;
                                &lt;/response&gt;
                        &lt;/method&gt;
                        &lt;method id="deleteService" name="DELETE"&gt;
                                &lt;response&gt;
                                        &lt;representation mediaType="*/*" /&gt;
                                &lt;/response&gt;
                        &lt;/method&gt;
                &lt;/resource&gt;
                &lt;resource path="/children"&gt;
                        &lt;method id="childDSRs" name="GET"&gt;
                                &lt;response&gt;
                                        &lt;representation mediaType="*/*" /&gt;
                                &lt;/response&gt;
                        &lt;/method&gt;
                        &lt;method id="checkin" name="POST"&gt;
                                &lt;response&gt;
                                        &lt;representation mediaType="*/*" /&gt;
                                &lt;/response&gt;
                        &lt;/method&gt;
                &lt;/resource&gt;
                &lt;resource path="/services"&gt;
                        &lt;method id="queryWithParamsForJSON" name="GET"&gt;
                                &lt;response&gt;
                                        &lt;representation mediaType="application/json" /&gt;
                                &lt;/response&gt;
                        &lt;/method&gt;
                        &lt;method id="queryWithParamsForXML" name="GET"&gt;
                                &lt;response&gt;
                                        &lt;representation mediaType="application/xml" /&gt;
                                        &lt;representation mediaType="text/xml" /&gt;
                                &lt;/response&gt;
                        &lt;/method&gt;
                        &lt;method id="richQueryForJSON" name="POST"&gt;
                                &lt;request&gt;
                                        &lt;representation mediaType="application/json" /&gt;
                                &lt;/request&gt;
                                &lt;response&gt;
                                        &lt;representation mediaType="application/json" /&gt;
                                &lt;/response&gt;
                        &lt;/method&gt;
                        &lt;method id="richQueryForXML" name="POST"&gt;
                                &lt;request&gt;
                                        &lt;representation mediaType="application/json" /&gt;
                                &lt;/request&gt;
                                &lt;response&gt;
                                        &lt;representation mediaType="application/xml" /&gt;
                                &lt;/response&gt;
                        &lt;/method&gt;
                        &lt;resource path="/urls"&gt;
                                &lt;method id="getServiceEndPoints" name="GET"&gt;
                                        &lt;response&gt;
                                                &lt;representation mediaType="application/json" /&gt;
                                        &lt;/response&gt;
                                &lt;/method&gt;
                        &lt;/resource&gt;
                        &lt;resource path="/types"&gt;
                                &lt;method id="getServiceTypes" name="GET"&gt;
                                        &lt;response&gt;
                                                &lt;representation mediaType="application/json" /&gt;
                                        &lt;/response&gt;
                                &lt;/method&gt;
                        &lt;/resource&gt;
                        &lt;resource path="/query.xml"&gt;
                                &lt;method id="queryXml" name="GET"&gt;
                                        &lt;response&gt;
                                                &lt;representation mediaType="application/xml" /&gt;
                                                &lt;representation mediaType="text/xml" /&gt;
                                        &lt;/response&gt;
                                &lt;/method&gt;
                        &lt;/resource&gt;
                        &lt;resource path="/pagedquery"&gt;
                                &lt;method id="pagedQuery" name="GET"&gt;
                                        &lt;response&gt;
                                                &lt;representation mediaType="application/json" /&gt;
                                        &lt;/response&gt;
                                &lt;/method&gt;
                                &lt;method id="pagedQueryGlue2" name="GET"&gt;
                                        &lt;response&gt;
                                                &lt;representation mediaType="application/xml" /&gt;
                                        &lt;/response&gt;
                                &lt;/method&gt;
                        &lt;/resource&gt;
                &lt;/resource&gt;
                &lt;resource path="/services/facet"&gt;
                        &lt;method id="getFacets" name="GET"&gt;
                                &lt;response&gt;
                                        &lt;representation mediaType="application/json" /&gt;
                                &lt;/response&gt;
                        &lt;/method&gt;
                &lt;/resource&gt;
                &lt;resource path="/neighbors"&gt;
                        &lt;method id="childDSRs" name="GET"&gt;
                                &lt;response&gt;
                                        &lt;representation mediaType="*/*" /&gt;
                                &lt;/response&gt;
                        &lt;/method&gt;
                &lt;/resource&gt;
                &lt;resource path="/model"&gt;
                        &lt;method id="getModel" name="GET"&gt;
                                &lt;response&gt;
                                        &lt;representation mediaType="text/html" /&gt;
                                        &lt;representation mediaType="application/json" /&gt;
                                &lt;/response&gt;
                        &lt;/method&gt;
                &lt;/resource&gt;
        &lt;/resources&gt;
&lt;/application&gt;</tt></pre>
</div></div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Version 1.3.0<br />
Last updated 2013-06-24 14:22:25 CEST
</div>
</div>
</body>
</html>
